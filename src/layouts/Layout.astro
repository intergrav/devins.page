---
import "@intergrav/slight.css";
import "../styles/global.css";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import { ClientRouter } from "astro:transitions";

const { title, description } = Astro.props;
---

<!doctype html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>{title} • devins.page</title>
		<meta name="description" content={description} />
		<meta name="author" content="intergrav" />
		<link rel="canonical" href={Astro.url.pathname} />

		<meta property="og:title" content={`${title} • devins.page`} />
		<meta property="og:description" content={description} />
		<meta property="og:type" content="website" />
		<meta property="og:url" content={Astro.url.pathname} />

		<link
			rel="icon"
			type="image/png"
			href="https://github.com/intergrav.png?size=64"
		/>
		<link rel="sitemap" href="/sitemap-index.xml" />
		<link
			rel="alternate"
			type="application/rss+xml"
			title="devin's page"
			href={new URL("rss.xml", Astro.site)}
		/>

		<ClientRouter />
		<script is:inline>
			(function () {
				function applyTheme() {
					const theme = localStorage.getItem("theme") || "default";
					document.documentElement[
						theme === "default" ? "removeAttribute" : "setAttribute"
					]("data-theme", theme);
				}

				function init() {
					const selector = document.getElementById("theme-selector");
					if (selector) {
						selector.value = localStorage.getItem("theme") || "default";
						selector.onchange = () => {
							localStorage.setItem("theme", selector.value);
							applyTheme();
						};
					}
					applyTheme();
				}

				init();
				document.addEventListener("astro:page-load", init);
			})();
		</script>
	</head>
	<body class="prose">
		<Header />
		<main><slot /></main>
		<button
			id="load-giscus"
			onclick="
				const script = document.createElement('script');
				script.id = 'giscus-script';
				script.src = 'https://giscus.app/client.js';
				script.setAttribute('data-repo', 'intergrav/devins.page');
				script.setAttribute('data-repo-id', 'R_kgDONW1wiA');
				script.setAttribute('data-category', 'giscus');
				script.setAttribute('data-category-id', 'DIC_kwDONW1wiM4Cr7lb');
				script.setAttribute('data-mapping', 'pathname');
				script.setAttribute('data-strict', '1');
				script.setAttribute('data-reactions-enabled', '1');
				script.setAttribute('data-emit-metadata', '0');
				script.setAttribute('data-input-position', 'bottom');
				script.setAttribute('data-theme', 'https://devins.page/giscus-theme.css');
				script.setAttribute('data-lang', 'en');
				script.crossOrigin = 'anonymous';
				script.async = true;
				this.insertAdjacentElement('afterend', script);
				this.remove();
			"
			type="button"
			style="margin-block: 1rem; margin-left: auto; margin-right: auto; display:block"
			>load giscus comments</button
		>
		<Footer />
	</body>
</html>
